<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
	builds wrimsv2 SG
     psandhu; Hao Xie                                                               
     ====================================================================== -->
<project name="wrimsv2_SG" default="default">
	<description>
            builds wrimsv2_SG distribution
    </description>
	<!-- software revision number -->
	<property name="version" value="1.0"/>
	<property name="dist.dir" location="build/dist/wrimsv2_SG"/>
	<property name="wrimsv2_SG.lib" location="lib" />
	<property name="jre6.installdir" location="..\3rd_party\jrockit-jre1.6.0_26-R28.1.4"/>
	<!--<property name="jre6.installdir" location="C:\Program Files (x86)\Java\jre6"/>-->
	<property name="vista.dir" location="..\3rd_party\vista"/>

	<!-- ================================= 
          target: default              
         ================================= -->
	<target name="default" depends="package" description="builds wrimsv2_SG distribution">
		<tstamp/>
	</target>

	<!-- - - - - - - - - - - - - - - - - - 
          target: compile                      
         - - - - - - - - - - - - - - - - - -->

	<target name="buildinfo">
	    <tstamp>
	        <format property="builtat" pattern="MM/dd/yyyy hh:mm aa" timezone="America/Los_Angeles"/>
	    </tstamp>        
	    <exec executable="svnversion" outputproperty="svnversion"/>
	    <exec executable="whoami" outputproperty="whoami"/>
	   <!-- <exec executable="uname" outputproperty="buildsystem"><arg value="-a"/></exec> -->

	    <propertyfile file="src/wrims/schematic/build.props"
	        comment="This file is automatically generated - DO NOT EDIT">        
	        <entry key="buildtime" value="${builtat}"/>
	        <entry key="build" value="${svnversion}"/>
	        <entry key="builder" value="${whoami}"/>
	        <entry key="version" value="${version}"/>
	        <entry key="system" value="${buildsystem}"/>
	    </propertyfile>
	</target>

	<target name="compile" depends="buildinfo">
		<mkdir dir="build/classes"/>
		<copy todir="build/classes">
			<fileset dir="bin">
				<include name="wrims/**/*.class"/>
			</fileset>
		</copy>			
		<copy todir="build/classes">
			<fileset dir="src">
				<include name="**/*.gif"/>
				<include name="**/*.png"/>
				<include name="**/*.jpg"/>
				<include name="**/*.properties"/>
				<include name="**/*.props"/>
				<include name="**/*.xml"/>
			</fileset>
		</copy>
	</target>
	
	<target name="package" depends="compile">
		<tstamp/>
		<mkdir dir="${dist.dir}"/>
		<copy todir="${dist.dir}">
			<fileset dir="resources">
				<exclude name="**/sample/*.dss"/>
				<exclude name="**/*.sh"/>
			</fileset>		
		</copy>
		<copy todir="${dist.dir}/lib">
			<fileset dir="lib">
				<exclude name="**/*.so"/>
			</fileset>
		</copy>
		<copy todir="${dist.dir}/jre6/">
			<fileset dir="${jre6.installdir}">
				<include name="**/**"/>
			</fileset>
		</copy>
		<copy todir="${dist.dir}/examples/">
			<fileset dir="examples">
				<include name="**/**"/>
			</fileset>
		</copy>
		<jar destfile="${dist.dir}/lib/wrimsv2_SG.jar" basedir="build/classes"></jar>
		<zip destfile="build/wrimsv2_SG-${DSTAMP}.zip" basedir="${dist.dir}/.." excludes="**/*study.sty" />
	</target>
	
	<target name="clean">
		<delete dir="build"/>
	</target>
	
	</project>
